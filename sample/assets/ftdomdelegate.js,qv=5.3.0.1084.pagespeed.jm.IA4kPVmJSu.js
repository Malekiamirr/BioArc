function Delegate(root){this.listenerMap=[{},{}];if(root){this.root(root);}this.handle=Delegate.prototype.handle.bind(this);this._removedListeners=[];}Delegate.prototype.root=function(root){const listenerMap=this.listenerMap;let eventType;if(this.rootElement){for(eventType in listenerMap[1]){if(listenerMap[1].hasOwnProperty(eventType)){this.rootElement.removeEventListener(eventType,this.handle,true);}}for(eventType in listenerMap[0]){if(listenerMap[0].hasOwnProperty(eventType)){this.rootElement.removeEventListener(eventType,this.handle,false);}}}if(!root||!root.addEventListener){if(this.rootElement){delete this.rootElement;}return this;}this.rootElement=root;for(eventType in listenerMap[1]){if(listenerMap[1].hasOwnProperty(eventType)){this.rootElement.addEventListener(eventType,this.handle,true);}}for(eventType in listenerMap[0]){if(listenerMap[0].hasOwnProperty(eventType)){this.rootElement.addEventListener(eventType,this.handle,false);}}return this;};Delegate.prototype.captureForType=function(eventType){return['blur','error','focus','load','resize','scroll'].indexOf(eventType)!==-1;};Delegate.prototype.on=function(eventType,selector,handler,useCapture){let root;let listenerMap;let matcher;let matcherParam;if(!eventType){throw new TypeError('Invalid event type: '+eventType);}if(typeof selector==='function'){useCapture=handler;handler=selector;selector=null;}if(useCapture===undefined){useCapture=this.captureForType(eventType);}if(typeof handler!=='function'){throw new TypeError('Handler must be a type of Function');}root=this.rootElement;listenerMap=this.listenerMap[useCapture?1:0];if(!listenerMap[eventType]){if(root){root.addEventListener(eventType,this.handle,useCapture);}listenerMap[eventType]=[];}if(!selector){matcherParam=null;matcher=matchesRoot.bind(this);}else if(/^[a-z]+$/i.test(selector)){matcherParam=selector;matcher=matchesTag;}else if(/^#[a-z0-9\-_]+$/i.test(selector)){matcherParam=selector.slice(1);matcher=matchesId;}else{matcherParam=selector;matcher=Element.prototype.matches;}listenerMap[eventType].push({selector:selector,handler:handler,matcher:matcher,matcherParam:matcherParam});return this;};Delegate.prototype.off=function(eventType,selector,handler,useCapture){let i;let listener;let listenerMap;let listenerList;let singleEventType;if(typeof selector==='function'){useCapture=handler;handler=selector;selector=null;}if(useCapture===undefined){this.off(eventType,selector,handler,true);this.off(eventType,selector,handler,false);return this;}listenerMap=this.listenerMap[useCapture?1:0];if(!eventType){for(singleEventType in listenerMap){if(listenerMap.hasOwnProperty(singleEventType)){this.off(singleEventType,selector,handler);}}return this;}listenerList=listenerMap[eventType];if(!listenerList||!listenerList.length){return this;}for(i=listenerList.length-1;i>=0;i--){listener=listenerList[i];if((!selector||selector===listener.selector)&&(!handler||handler===listener.handler)){this._removedListeners.push(listener);listenerList.splice(i,1);}}if(!listenerList.length){delete listenerMap[eventType];if(this.rootElement){this.rootElement.removeEventListener(eventType,this.handle,useCapture);}}return this;};Delegate.prototype.handle=function(event){let i;let l;const type=event.type;let root;let phase;let listener;let returned;let listenerList=[];let target;const eventIgnore='ftLabsDelegateIgnore';if(event[eventIgnore]===true){return;}target=event.target;if(target.nodeType===3){target=target.parentNode;}if(target.correspondingUseElement){target=target.correspondingUseElement;}root=this.rootElement;phase=event.eventPhase||(event.target!==event.currentTarget?3:2);switch(phase){case 1:listenerList=this.listenerMap[1][type];break;case 2:if(this.listenerMap[0]&&this.listenerMap[0][type]){listenerList=listenerList.concat(this.listenerMap[0][type]);}if(this.listenerMap[1]&&this.listenerMap[1][type]){listenerList=listenerList.concat(this.listenerMap[1][type]);}break;case 3:listenerList=this.listenerMap[0][type];break;}let toFire=[];l=listenerList.length;while(target&&l){for(i=0;i<l;i++){listener=listenerList[i];if(!listener){break;}if(target.tagName&&["button","input","select","textarea"].indexOf(target.tagName.toLowerCase())>-1&&target.hasAttribute("disabled")){toFire=[];}else if(listener.matcher.call(target,listener.matcherParam,target)){toFire.push([event,target,listener]);}}if(target===root){break;}l=listenerList.length;target=target.parentElement||target.parentNode;if(target instanceof HTMLDocument){break;}}let ret;for(i=0;i<toFire.length;i++){if(this._removedListeners.indexOf(toFire[i][2])>-1){continue;}returned=this.fire.apply(this,toFire[i]);if(returned===false){toFire[i][0][eventIgnore]=true;toFire[i][0].preventDefault();ret=false;break;}}return ret;};Delegate.prototype.fire=function(event,target,listener){return listener.handler.call(target,event,target);};function matchesTag(tagName,element){return tagName.toLowerCase()===element.tagName.toLowerCase();}function matchesRoot(selector,element){if(this.rootElement===window){return(element===document||element===document.documentElement||element===window);}return this.rootElement===element;}function matchesId(id,element){return id===element.id;}Delegate.prototype.destroy=function(){this.off();this.root();};